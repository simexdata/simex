
import { parseISODate, addDays } from './dates.js'
export function sumWeekHours(records){const totals={mon:0,tue:0,wed:0,thu:0,fri:0,sat:0,sun:0};let total=0;for(const r of records||[]){for(const k of Object.keys(totals)){const v=Number(r[k]||0);totals[k]+=v;total+=v}}return {totals,total}}
export function filterTimesheetsInRange(timesheets,empId,startISO,endISO){const res=[];const start=parseISODate(startISO);const end=parseISODate(endISO);const map=(timesheets&&timesheets[empId])||{};for(const weekStartISO of Object.keys(map)){const weekStart=parseISODate(weekStartISO);const weekEnd=addDays(weekStart,6);if(weekEnd<start||weekStart>end)continue;res.push({weekStartISO,records:map[weekStartISO]})}return res.sort((a,b)=>a.weekStartISO.localeCompare(b.weekStartISO))}
export function calcPayslip(timesheets,emp,startISO,endISO){const weeks=filterTimesheetsInRange(timesheets,emp.id,startISO,endISO);let hours=0;for(const w of weeks){const {total}=sumWeekHours(w.records);hours+=total}const rate=Number(emp.hourlyRate||0);const gross=hours*rate;const taxes=gross*0.1;const insurance=gross*0.065;const net=gross-taxes-insurance;return {employeeId:emp.id,employeeName:emp.name,periodStart:startISO,periodEnd:endISO,hours,rate,gross,taxes,insurance,net}}
